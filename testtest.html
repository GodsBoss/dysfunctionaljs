<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head><title>Test Test</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<link rel="stylesheet" type="text/css" href="common.css">
<script type="text/javascript" src="test/test.js"></script>
<script type="text/javascript">
/**
* Tests the TestRunner. Should really be named 'testTestRunner',
* but that sounds stupid.
*/
function testRunner(){
	var result;
	var output=function(obj){
		result=obj;};
	var runner=new TestFramework.TestRunner({truthy:function(val){return !!val;}}, output);
	var runnerResults=document.getElementById('results-runner');
	var ul=document.createElement('ul');

	function makeLi(content, className){
		var li=document.createElement('li');
		li.className=className
		li.innerHTML=content;
		ul.appendChild(li);}

	runner.run([{test:function(fw){},description:'Description'}]);
	if(result.description='Description'){
		makeLi('Test description is working.', 'success');}
	else{
		makeLi('Test description not working.', 'fail');}

	runner.run([{test:function(fw){fw.truthy(true);},description:'Description'}]);
	if(result.success){
		makeLi('Assertion which is true detected correctly.', 'success');}
	else{
		makeLi('Assertion which is true not detected correctly.', 'fail');}

	runner.run([{test:function(fw){fw.truthy(false);},description:'Description'}]);
	if(!result.success){
		makeLi('Assertion which is false detected correctly.', 'success');}
	else{
		makeLi('Assertion which is false not detected correctly.', 'fail');}

	runnerResults.appendChild(ul);}

/**
* Test framework's assert functions.
*/
function testAsserts(){
	var assertResults=document.getElementById('results-asserts');
	var ul=document.createElement('ul');
	var a=TestFramework.asserts; // Shortcut
	var summary=document.createElement('p');
	var tests=0, successes=0;

	function check(description, success){
		tests++;
		if(success){
			successes++;}
		var li=document.createElement('li');
		li.className=success?'success':'fail';
		li.innerHTML=description;
		ul.appendChild(li);}

	var truthy={
		'assertTrue(true)':a.assertTrue(true),
		'assertFalse(false)':a.assertFalse(false),
		'assertNull(null)':a.assertNull(null),
		'assertUndefined(undefined)':a.assertUndefined(),
		'assertNotNull(false)':a.assertNotNull(false),
		'assertNaN(NaN)':a.assertNaN(NaN),
		'assertNotNaN(55)':a.assertNotNaN(55),
		'assertTruthy(true)':a.assertTruthy(true),
		'assertTruthy(1)':a.assertTruthy(1),
		'assertTruthy("foo")':a.assertTruthy("foo"),
		'assertTruthy([])':a.assertTruthy([]),
		'assertTruthy({})':a.assertTruthy({}),
		'assertTruthy(/foo/)':a.assertTruthy(/foo/),
		'assertTruthy(new Date())':a.assertTruthy(new Date()),
		'assertFalsy(false)':a.assertFalsy(false),
		'assertFalsy(0)':a.assertFalsy(0),
		'assertFalsy(null)':a.assertFalsy(null),
		'assertFalsy(undefined)':a.assertFalsy(),
		'assertFalsy("")':a.assertFalsy(""),
		'assertFalsy(NaN)':a.assertFalsy(NaN),
		'assertEqual(1, "1")':a.assertEqual(1,"1"),
		'assertEqual(true, true)':a.assertEqual(true,true),
		'assertIdentical(1, 1)':a.assertIdentical(1,1),
		'assertIdentical(null, null)':a.assertIdentical(null,null),
		'assertPropertyEquals({x:5},"x",5)':a.assertPropertyEquals({x:5},"x",5),
		'assertPropertyExists({x:10},"x")':a.assertPropertyExists({x:5},"x"),
		'assertBoolean(true)':a.assertBoolean(true),
		'assertBoolean(false)':a.assertBoolean(false),
		'assertString("")':a.assertString(""),
		'assertObject({x:5})':a.assertObject({x:5}),
		'assertArray([])':a.assertArray([]),
		'assertNumber(0)':a.assertNumber(0),
		'assertNumber(-Infinity)':a.assertNumber(-Infinity),
		'assertNumber(NaN)':a.assertNumber(NaN),
		'assertFinite(100)':a.assertFinite(100),
		'assertFinite("100")':a.assertFinite("100"),
		'assertNotFinite(NaN)':a.assertNotFinite(NaN),
		'assertNotFinite("Hello, world!")':a.assertNotFinite("Hello, world!"),
		'assertNotFinite(Infinity)':a.assertNotFinite(Infinity),
		'assertPositiveInfinity(+Infinity)':a.assertPositiveInfinity(+Infinity),
		'assertNegativeInfinity(-Infinity)':a.assertNegativeInfinity(-Infinity)
	};

	for(var desc in truthy){
		check(desc+' is true.', truthy[desc]);}

	var falsy={
		'assertTrue(1)':a.assertTrue(1),
		'assertTrue("foo")':a.assertTrue("foo"),
		'assertTrue({})':a.assertTrue({}),
		'assertTrue([])':a.assertTrue([]),
		'assertTrue(false)':a.assertTrue(false),
		'assertFalse(0)':a.assertFalse(0),
		'assertFalse("")':a.assertFalse(""),
		'assertFalse(null)':a.assertFalse(null),
		'assertFalse(undefined)':a.assertFalse(),
		'assertNull(false)':a.assertNull(false),
		'assertNull("")':a.assertNull(""),
		'assertNull(0)':a.assertNull(0),
		'assertNull(undefined)':a.assertNull(),
		'assertUndefined(null)':a.assertUndefined(null),
		'assertUndefined(false)':a.assertUndefined(false),
		'assertUndefined(0)':a.assertUndefined(0),
		'assertNotNull(null)':a.assertNotNull(null),
		'assertNaN(15)':a.assertNaN(15),
		'assertNaN(false)':a.assertNaN(false),
		'assertNaN(+Infinity)':a.assertNaN(+Infinity),
		'assertNotNaN(NaN)':a.assertNotNaN(NaN),
		'assertTruthy(0)':a.assertTruthy(0),
		'assertTruthy(null)':a.assertTruthy(null),
		'assertTruthy(false)':a.assertTruthy(false),
		'assertTruthy(undefined)':a.assertTruthy(),
		'assertTruthy(NaN)':a.assertTruthy(NaN),
		'assertTruthy("")':a.assertTruthy(""),
		'assertFalsy(1)':a.assertFalsy(1),
		'assertFalsy("xyz")':a.assertFalsy("xyz"),
		'assertFalsy(true)':a.assertFalsy(true),
		'assertFalsy([])':a.assertFalsy([]),
		'assertFalsy({})':a.assertFalsy({}),
		'assertEqual(1, 2)':a.assertEqual(1,2),
		'assertEqual(true, 0)':a.assertEqual(true,0),
		'assertIdentical("1", 1)':a.assertIdentical("1",1),
		'assertIdentical(false, 0)':a.assertIdentical(false,0),
		'assertIdentical(null, undefined)':a.assertIdentical(null),
		'assertPropertyEquals({x:2},"x",3)':a.assertPropertyEquals({x:2},"x",3),
		'assertPropertyExists({x:2},"y")':a.assertPropertyExists({x:2},"y"),
		'assertBoolean(2)':a.assertBoolean(0),
		'assertBoolean(null)':a.assertBoolean(null),
		'assertString(55)':a.assertString(55),
		'assertString(true)':a.assertString(true),
		'assertObject([])':a.assertObject([]),
		'assertObject(null)':a.assertObject(null),
		'assertArray({0:1,length:1})':a.assertArray({0:1,length:1}),
		'assertNumber("100")':a.assertNumber("100"),
		'assertNumber(null)':a.assertNumber(null),
		'assertFinite("foobar")':a.assertFinite("foobar"),
		'assertFinite(NaN)':a.assertFinite(NaN),
		'assertFinite(Infinity)':a.assertFinite(Infinity),
		'assertNotFinite(20)':a.assertNotFinite(20),
		'assertNotFinite("-50")':a.assertNotFinite("-50"),
		'assertPositiveInfinity(-Infinity)':a.assertPositiveInfinity(-Infinity),
		'assertPositiveInfinity(NaN)':a.assertPositiveInfinity(NaN),
		'assertPositiveInfinity("50")':a.assertPositiveInfinity("50"),
		'assertNegativeInfinity(+Infinity)':a.assertNegativeInfinity(+Infinity),
		'assertNegativeInfinity(NaN)':a.assertNegativeInfinity(NaN),
		'assertNegativeInfinity("50")':a.assertNegativeInfinity("50")
	};

	for(var desc in falsy){
		check(desc+' is false.', !falsy[desc]);}

	summary.innerHTML='From '+tests+' tests, '+successes+' were successful and '+(tests-successes)+' failed.';
	summary.className='summary '+(tests==successes?'success':'fail');

	assertResults.appendChild(summary);
	assertResults.appendChild(ul);}

function runTests(){
	testRunner();
	testAsserts();}
</script>
</head>
<body onload="runTests();">
<h1>Test Tests</h1>
<h2>Overview</h2>
<p>This page tests the little test framework.</p>
<p>Two things are tested: The assert functions coming with the framework and the test runner. Both are independent of each other.</p>
<h2>Test results</h2>
<noscript>
<p class="error nojs">Ooooops, JavaScript should be activated for the tests.</p>
</noscript>
<h3><code>Framework.TestRunner</code></h3>
<div id="results-runner" class="results"></div>
<h3><code>Framework.asserts</code></h3>
<div id="results-asserts" class="results"></div>
</body>
</html>
